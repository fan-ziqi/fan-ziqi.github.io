# 7-链接器

从文本形式的源文件到可执行文件中间其实经过了编译和链接两个步骤，本文来讨论一下C++链接器是如何工作的。

## 什么是链接

当我们编译好源文件，我们需要通过一个叫做链接的过程。链接的任务是找到每个符号和函数所在的地方，并把它们链接起来。多个翻译单元（一个CPP文件可以理解为一个翻译单元）之间并不互通，我们需要一种方法把这些文件连接起来成一个项目。即使只有一个翻译单元，也需要将main函数连接起来，这就是链接器的主要目的和要做的事情。

## 一些常见的链接错误

### 未解决的外部符号

当链接器找不到确切定义时会发生。来看一段代码：

```cpp
void Log(const char* message);

void Multiply(int a, int b)
{
	Log("Multiply");
}

int main()
{
	return 0;
}
```

在这段代码中，Multiply函数没有被任何函数调用，其中的Log函数虽然被声明了但是并没有并定义。这样依然会报错。虽然我们没有使用Multiply函数，但是在技术上来讲，我们有可能会用到Log函数，所以链接器需要链接到它，所以会报错。但是如果使用static将Multiply函数限制在该文件中使用`static void Multiply(int a, int b)`，由于我们没有使用该函数，所以不再报错。

如果一个函数的声明和定义中的输入和返回的数据类型不对应，也会报错。

### 有重复的符号

如果我们的函数或变量具有相同的名字或签名，链接器会不知道该链接哪一个。即使没有申明，两个相同的函数放在不同的文件中，依然会报错。

## 总结

一般来说，如果一个函数需要在其它文件中使用，则要将函数的定义写在cpp中，然后在对应的hpp文件中写上该函数的声明，最后在需要用它的文件中#include这个hpp文件即可避免链接错误。

------

**文章作者:** [范子琦](https://github.com/fan-ziqi)

**文章链接:** https://www.fanziqi.site/categories/C/

**版权声明:** 本博客所有文章除特别声明外，均采用 [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/) 许可协议。转载请注明来自 [范子琦的博客](http://www.fanziqi.site/)！

